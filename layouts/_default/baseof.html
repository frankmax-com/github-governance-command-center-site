<!doctype html>
<html lang="{{ .Site.Language.Lang }}">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}</title>
        <meta name="description" content="{{ if .Description }}{{ .Description }}{{ else }}{{ .Site.Params.description }}{{ end }}">
        <link rel="canonical" href="{{ .Permalink }}">

        <!-- Pre-paint theme: manual override takes precedence; else auto by local hour -->
        <script>
            (function(){
                try {
                    var stored = localStorage.getItem('theme');
                    var theme = stored && (stored === 'light' || stored === 'dark') ? stored : '';
                    if (!theme) {
                        var h = (new Date()).getHours();
                        theme = (h >= 6 && h < 18) ? 'light' : 'dark';
                    }
                    document.documentElement.setAttribute('data-theme', theme);
                    document.documentElement.style.colorScheme = theme;
                                    if (!stored) {
                                        try { window.dispatchEvent(new CustomEvent('theme_auto_applied', { detail: { theme: theme } })); } catch(e){}
                                        try { if (window.gtag) { window.gtag('event', 'theme_auto_applied', { theme: theme }); } } catch(e){}
                                    }
                } catch(e) {
                    var hh = (new Date()).getHours();
                    var t = (hh >= 6 && hh < 18) ? 'light' : 'dark';
                    document.documentElement.setAttribute('data-theme', t);
                    document.documentElement.style.colorScheme = t;
                }
            })();
        </script>

        <link rel="icon" type="image/png" href="{{ "images/favicon.png" | relURL }}">
    <link href="{{ "css/crisis.css" | relURL }}" rel="stylesheet">
    {{ $fortressCSS := resources.Get "css/fortress.css" }}
    {{ $fortressCSS = $fortressCSS | resources.Minify | resources.Fingerprint }}
    <link rel="stylesheet" href="{{ $fortressCSS.RelPermalink }}" integrity="{{ $fortressCSS.Data.Integrity }}" crossorigin="anonymous">
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    </head>
    <body class="font-inter">
    <a href="#main-content" class="skip-link">Skip to content</a>
        <header class="site-header" role="banner">
            <div class="container">
                <nav class="nav" role="navigation" aria-label="Main navigation">
                      <a href="{{ "/" | relLangURL }}" class="brand" aria-label="Home">
                        <svg width="28" height="28" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                            <defs>
                                <linearGradient id="brandGrad" x1="0" x2="1" y1="0" y2="1">
                                    <stop offset="0%" stop-color="#2563eb"/>
                                    <stop offset="100%" stop-color="#1d4ed8"/>
                                </linearGradient>
                            </defs>
                            <rect x="2" y="2" width="20" height="20" rx="6" fill="url(#brandGrad)"/>
                            <path d="M8 12l3 3 5-6" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="brand-text">Frankmax</span>
                    </a>

                    <button class="nav-toggle" aria-controls="mobile-nav" aria-expanded="false" aria-label="Open menu">☰</button>

                    <div class="nav-links" id="desktop-nav">
                        {{ $current := . }}
                        {{ $root := "/" | relURL }}
                        {{ range .Site.Menus.main }}
                            {{ $menuPath := .URL | relURL }}
                            {{ $currentPath := $current.RelPermalink | relURL }}
                            {{ $isActive := or (eq $currentPath $menuPath) (and (ne $menuPath $root) (hasPrefix $currentPath $menuPath)) }}
                            <a class="nav-link{{ if $isActive }} active{{ end }}" href="{{ $menuPath }}"{{ if $isActive }} aria-current="page"{{ end }}>{{ .Name }}</a>
                        {{ end }}
                    </div>

                    <div class="nav-tools">
                        {{ if hugo.IsMultilingual }}
                            <div>
                                {{ if eq $.Site.Language.Lang "en-xx" }}
                                    <span class="lang-pill" aria-current="true">English</span>
                                    <a class="lang-link" href="{{ "zh-sg/" | relURL }}">中文</a>
                                {{ else }}
                                    <a class="lang-link" href="{{ "en-xx/" | relURL }}">English</a>
                                    <span class="lang-pill" aria-current="true">中文</span>
                                {{ end }}
                            </div>
                        {{ end }}
                        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle color theme" aria-pressed="false" title="Toggle color theme"></button>
                        <a class="btn btn-primary" href="{{ "solutions" | relURL }}">Get started</a>
                    </div>
                </nav>

                <div class="mobile-menu" id="mobile-nav" hidden>
                    <div class="mobile-links">
                        {{ range .Site.Menus.main }}
                              <a class="mobile-link" href="{{ .URL | relURL }}">{{ .Name }}</a>
                        {{ end }}
                    </div>
                    {{ if hugo.IsMultilingual }}
                    <div class="mobile-tools">
                        {{ if eq $.Site.Language.Lang "en-xx" }}
                            <span class="lang-pill w-full" aria-current="true">English</span>
                            <a class="lang-link w-full" href="{{ "zh-sg/" | relURL }}">中文</a>
                        {{ else }}
                            <a class="lang-link w-full" href="{{ "en-xx/" | relURL }}">English</a>
                            <span class="lang-pill w-full" aria-current="true">中文</span>
                        {{ end }}
                    </div>
                    {{ end }}
                </div>
            </div>
        </header>

        <main class="main" id="main-content">
            {{ block "main" . }}{{ end }}
        </main>

        <footer class="site-footer" role="contentinfo">
            <div class="container footer-inner">
                <div>© {{ now.Year }} Frankmax. All rights reserved.</div>
                <nav class="footer-nav" aria-label="Footer">
                      <a href="{{ "sitemap" | relURL }}">Sitemap</a>
                      <a href="{{ "about" | relURL }}">About</a>
                      <a href="{{ "contact" | relURL }}">Contact</a>
                </nav>
            </div>
        </footer>

        <script>
            (function(){
                var root = document.documentElement;
                var btn = document.getElementById('theme-toggle');
                function applyIcon(theme){
                    var svg = theme === 'dark'
                        ? '<svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" fill="currentColor"/></svg>'
                        : '<svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="5" fill="currentColor"/><g stroke="currentColor" stroke-width="2"><line x1="12" y1="1" x2="12" y2="4"/><line x1="12" y1="20" x2="12" y2="23"/><line x1="1" y1="12" x2="4" y2="12"/><line x1="20" y1="12" x2="23" y2="12"/><line x1="4.22" y1="4.22" x2="6.34" y2="6.34"/><line x1="17.66" y1="17.66" x2="19.78" y2="19.78"/><line x1="4.22" y1="19.78" x2="6.34" y2="17.66"/><line x1="17.66" y1="6.34" x2="19.78" y2="4.22"/></g></svg>';
                    btn.innerHTML = svg;
                    btn.setAttribute('aria-pressed', theme === 'dark');
                    btn.setAttribute('title', 'Toggle color theme');
                }
                function currentTheme(){ return root.getAttribute('data-theme') || 'light'; }
                function setTheme(t){ root.setAttribute('data-theme', t); root.style.colorScheme = t; try { localStorage.setItem('theme', t); } catch(e){} applyIcon(t); }
        if(btn){ applyIcon(currentTheme()); btn.addEventListener('click', function(){ var next = currentTheme() === 'light' ? 'dark' : 'light'; setTheme(next); try { window.dispatchEvent(new CustomEvent('theme_user_override', { detail: { theme: next } })); } catch(e){} try { if (window.gtag) { window.gtag('event', 'theme_user_override', { theme: next }); } } catch(e){} }); }

                var menuBtn = document.querySelector('.nav-toggle');
                var mobile = document.getElementById('mobile-nav');
                if(menuBtn && mobile){ menuBtn.addEventListener('click', function(){ var expanded = this.getAttribute('aria-expanded') === 'true'; this.setAttribute('aria-expanded', String(!expanded)); mobile.hidden = expanded; }); }

                // Optional: highlight active section in ToC
                try {
                    var toc = document.querySelector('.toc');
                    if (toc && 'IntersectionObserver' in window) {
                        var links = toc.querySelectorAll('a[href^="#"]');
                        var map = new Map();
                        links.forEach(function(a){
                            var id = decodeURIComponent(a.getAttribute('href').slice(1));
                            var el = document.getElementById(id);
                            if (el) { map.set(el, a); }
                        });
                        var active;
                        var ob = new IntersectionObserver(function(entries){
                            entries.forEach(function(e){
                                var link = map.get(e.target);
                                if(!link) return;
                                if (e.isIntersecting) { if(active) active.classList.remove('active'); link.classList.add('active'); active = link; }
                            });
                        }, { rootMargin: '-96px 0px -70% 0px', threshold: [0] });
                        map.forEach(function(_, el){ ob.observe(el); });
                    }
                } catch(e){}
            })();
    </script>
    {{ $fortressJS := resources.Get "js/fortress-ui.js" }}
    {{ $fortressJS = $fortressJS | resources.Minify | resources.Fingerprint }}
    <script defer src="{{ $fortressJS.RelPermalink }}" integrity="{{ $fortressJS.Data.Integrity }}" crossorigin="anonymous"></script>
    </body>
</html>